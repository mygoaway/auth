# Pinpoint APM override
# 사용법: docker compose -f docker-compose.yml -f docker-compose.pinpoint.yml --profile pinpoint up -d
#
# 이 파일은 기본 docker-compose.yml에 Pinpoint Agent 환경변수와 볼륨을 추가합니다.
# pinpoint-agent 컨테이너가 먼저 에이전트 파일을 볼륨에 복사한 뒤 backend가 시작됩니다.

services:
  backend:
    environment:
      PINPOINT_ACTIVE: "true"
      PINPOINT_AGENT_ID: "auth-backend-1"
      PINPOINT_APP_NAME: "auth-service"
    volumes:
      - pinpoint-agent-volume:/pinpoint-agent:ro
    depends_on:
      pinpoint-agent:
        condition: service_completed_successfully
      pinpoint-collector:
        condition: service_started

volumes:
  pinpoint-agent-volume:
